# 字段管理功能使用说明

## 功能概述

新增的字段管理系统允许你灵活定义推送字段，然后在推送配置中使用这些字段，实现动态表单推送。

## 核心概念

### 1. 字段定义（Field Schema）
- 可复用的字段模板
- 定义字段的名称、类型、验证规则等
- 支持多种字段类型：文本、多行文本、数字、日期、下拉选择、URL、邮箱

### 2. 推送配置（Push Config）
- 关联多个字段定义
- 使用字段的 key 作为模板变量
- 推送时根据关联的字段动态生成表单

## 使用流程

### 步骤 1：定义字段

1. 进入**字段定义**页面
2. 点击**新增字段**
3. 填写字段信息：
   - **字段名称**：显示给用户看的名称，如"标题"
   - **字段Key**：用于模板变量的标识符，如"title"（会在模板中作为 `{{title}}`）
   - **字段类型**：选择合适的输入类型
   - **描述**：字段说明
   - **占位符**：输入框的提示文字
   - **默认值**：预设的默认值
   - **必填**：是否为必填项

**示例字段**：
```
字段名称: 标题
字段Key: title
类型: 单行文本
描述: 推送消息的标题
占位符: 请输入标题
必填: 是
```

```
字段名称: 内容
字段Key: content
类型: 多行文本
描述: 推送消息的正文内容
占位符: 请输入内容
必填: 是
```

```
字段名称: 优先级
字段Key: priority
类型: 下拉选择
描述: 消息优先级
选项: ["低", "中", "高"]
必填: 否
默认值: 中
```

### 步骤 2：配置推送使用的字段

1. 进入**推送配置**页面
2. 选择一个配置，点击**字段**按钮
3. 在穿梭框中选择需要的字段
4. 点击**保存**

### 步骤 3：编写推送模板

在推送配置的**推送模板**中，使用字段的 key 作为变量：

```json
{
  "title": "{{title}}",
  "content": "{{content}}",
  "priority": "{{priority}}",
  "timestamp": "{{timestamp}}"
}
```

### 步骤 4：测试推送

1. 点击配置的**测试**按钮
2. 系统会根据关联的字段自动生成表单
3. 填写各字段的值
4. 点击**发送测试**

系统会自动将表单数据替换到模板中的对应变量。

## 字段类型说明

| 类型 | 说明 | 适用场景 |
|------|------|----------|
| text | 单行文本输入 | 标题、名称等短文本 |
| textarea | 多行文本输入 | 内容、描述等长文本 |
| number | 数字输入 | 数量、价格等数值 |
| date | 日期选择器 | 日期、时间 |
| select | 下拉选择 | 优先级、状态等固定选项 |
| url | URL输入 | 链接地址 |
| email | 邮箱输入 | 电子邮件地址 |

## 高级用法

### 1. 下拉选择字段配置

在创建 select 类型字段时，需要在**选项**中填写 JSON 数组：

```json
["选项1", "选项2", "选项3"]
```

### 2. 模板变量替换规则

- 变量格式：`{{field_key}}`
- 变量会被替换为用户输入的实际值
- 未找到对应字段的变量会保持原样

### 3. 字段复用

同一个字段可以被多个推送配置使用，方便统一管理常用字段。

## API 端点

### 字段管理
- `GET /api/fields` - 获取字段列表
- `POST /api/fields` - 创建字段
- `PUT /api/fields/:id` - 更新字段
- `DELETE /api/fields/:id` - 删除字段

### 配置字段关联
- `GET /api/push/configs/:id/fields` - 获取配置的字段
- `PUT /api/push/configs/:id/fields` - 更新配置的字段

## 最佳实践

1. **合理命名字段 Key**：使用有意义的英文单词，如 `title`、`content`、`user_name`
2. **设置必填项**：对于重要字段标记为必填，确保数据完整
3. **使用默认值**：为常用字段设置默认值，提高效率
4. **字段分类管理**：可以通过描述字段来说明字段的用途和分类
5. **测试验证**：新建字段后，务必在测试推送中验证效果

## 数据库结构

### FieldSchema（字段定义表）
```go
type FieldSchema struct {
    ID           uint
    Name         string    // 字段名称
    Key          string    // 字段key（唯一）
    Type         string    // 字段类型
    Description  string    // 描述
    Required     bool      // 是否必填
    DefaultValue string    // 默认值
    Options      string    // 选项（JSON）
    Placeholder  string    // 占位符
    Validation   string    // 验证规则
    UserID       uint      // 创建者
}
```

### ConfigFieldRelation（配置-字段关联表）
```go
type ConfigFieldRelation struct {
    ID       uint
    ConfigID uint      // 配置ID
    FieldID  uint      // 字段ID
    Order    int       // 显示顺序
}
```

## 常见问题

**Q: 删除字段会影响已有配置吗？**
A: 会。删除字段后，使用该字段的配置可能无法正常推送。建议删除前检查字段的使用情况。

**Q: 字段Key可以修改吗？**
A: 可以修改，但需要同步更新所有使用该字段的推送模板。

**Q: 如何实现字段验证？**
A: 目前支持必填验证，未来版本将支持自定义验证规则（Validation 字段预留）。

**Q: 能否导入导出字段配置？**
A: 当前版本暂不支持，后续版本会考虑添加批量导入导出功能。
